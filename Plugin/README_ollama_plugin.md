# Ollama 画板控制插件

这个插件允许通过 Ollama 的自然语言处理能力来控制画板应用，实现从自然语言到图像绘制的转换。

## 功能介绍

- **自然语言转绘图命令**：通过 Ollama AI 模型将用户的自然语言描述转换为画板 API 命令
- **完整的绘图控制**：支持绘制直线、圆形、矩形、文本，以及设置颜色、线宽等操作
- **多种使用方式**：提供命令行交互、Web 界面和测试脚本三种使用方式
- **实时反馈**：执行命令后立即在画板上看到结果

## 工作流程

```
用户输入(自然语言) → Ollama AI模型 → 转换为API命令 → Python插件 → 画板API → 画板应用
```

## 安装与设置

### 前提条件

1. **Ollama**：确保已安装并运行 Ollama 服务
   - 下载地址：[https://ollama.com/](https://ollama.com/)
   - 安装后运行服务（默认端口 11434）
   - 拉取模型：`ollama pull llama3`（或其他支持中文的模型）

2. **Python 环境**：确保已安装 Python 3.6 或更高版本

3. **依赖库**：安装所需的 Python 依赖
   ```bash
   pip install requests
   ```

4. **画板应用**：确保画板 Web 服务正在运行（默认 http://localhost:8000）

### 文件结构

- `ollama_draw_plugin.py` - 核心插件文件，包含与 Ollama 和画板交互的功能
- `test_ollama_plugin.py` - 测试脚本，用于验证功能是否正常
- `ollama_control.html` - Web 控制界面，可以在浏览器中使用
- `api.js` - 画板 API 文件（已修改以支持远程命令）
- `draw_api.py` - Python 画板 API 封装

## 使用方法

### 1. 命令行交互模式

```bash
python ollama_draw_plugin.py
```

在交互模式下，你可以：
- 输入自然语言描述你想要绘制的图形
- 直接输入 API 命令进行精确控制
- 输入 `help` 查看帮助信息
- 输入 `exit` 退出程序

示例：
```
请输入: 在左上角画一个红色圆形
正在转换自然语言为API命令...
转换结果: draw(circle,50,50,30)
执行结果: 圆形绘制成功
```

### 2. Web 界面控制

1. 打开 `ollama_control.html` 文件（可以直接在浏览器中打开）
2. 确保连接设置正确（默认情况下应该不需要修改）
3. 在自然语言输入框中输入你的绘图需求
4. 点击「发送命令」按钮
5. 查看画板上的绘制结果

### 3. 使用测试脚本

```bash
python test_ollama_plugin.py
```

测试脚本会自动执行一系列测试，包括：
- 基本绘图命令测试
- 自然语言转命令测试
- 颜色和样式设置测试
- 清空画布功能测试

## 支持的命令

### 1. 绘图命令

- **绘制直线**: `draw(line,x1,y1,x2,y2)`
  - 示例: `draw(line,100,100,500,100)`

- **绘制圆形**: `draw(circle,x,y,radius)`
  - 示例: `draw(circle,300,200,50)`

- **绘制矩形**: `draw(rect,x,y,width,height)`
  - 示例: `draw(rect,200,250,200,100)`

- **绘制文本**: `draw(text,x,y,"content")`
  - 示例: `draw(text,250,380,"Ollama测试")`

### 2. 设置命令

- **设置颜色**: `setColor(color)`
  - 颜色可以是颜色名称或十六进制代码
  - 示例: `setColor("red")` 或 `setColor("#ff0000")`

- **设置线宽**: `setLineWidth(width)`
  - width 是数字
  - 示例: `setLineWidth(5)`

### 3. 画布命令

- **清空画布**: `clear()`

- **导出图片**: `export()`

## 自然语言示例

以下是一些自然语言输入的示例，Ollama 模型会将它们转换为相应的 API 命令：

- 「在左上角画一个红色圆形」
- 「在右下角写'Hello World'」
- 「从顶部中央到底部中央画一条蓝色直线」
- 「画一个绿色矩形在中间位置」
- 「设置线宽为10，然后画一个黄色的太阳」

## 故障排除

### 常见问题

1. **无法连接到 Ollama 服务**
   - 检查 Ollama 服务是否正在运行
   - 确保端口 11434 未被占用
   - 确认模型（如 llama3）已下载

2. **无法连接到画板服务**
   - 确保画板 Web 服务正在运行（默认端口 8000）
   - 检查浏览器中的画板页面是否正常打开

3. **自然语言转换不准确**
   - 尝试使用更明确的描述
   - 可以考虑使用更适合中文的模型
   - 直接使用 API 命令进行精确控制

4. **命令执行错误**
   - 检查命令格式是否正确
   - 确保参数值在有效范围内（如坐标、半径等）

### 日志和调试

插件会在命令行中显示详细的执行信息和错误提示，可以通过这些信息进行故障排查。

## 扩展开发

如果你想扩展这个插件的功能，可以考虑：

1. 添加更多绘图命令支持
2. 优化自然语言处理的提示词模板
3. 支持更多的 Ollama 模型选择
4. 增强 Web 界面的交互性

## 许可证

本项目为开源项目，欢迎贡献和改进。